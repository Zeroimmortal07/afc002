<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amma Food Center - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(180deg, #f5f3ff 0%, #ffffff 100%);
        }

        .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        }

        .card-hover {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            background-color: #faf5ff;
        }
    </style>
</head>

<body class="min-h-screen p-6">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="gradient-purple text-white rounded-2xl p-6 mb-6 shadow-xl">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">Admin Dashboard</h1>
                    <p class="text-purple-100 mt-1">Manage orders and menu items</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="last-updated" class="text-sm text-purple-100 font-medium">Updating...</span>
                    <button onclick="fetchData()"
                        class="bg-white text-purple-600 px-5 py-2 rounded-xl font-bold hover:shadow-lg transition-all transform hover:scale-105">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex space-x-3 mb-6">
            <button onclick="switchTab('orders')" id="tab-orders"
                class="px-6 py-3 rounded-xl font-bold transition-all bg-purple-600 text-white shadow-lg">
                üì¶ Orders
            </button>
            <button onclick="switchTab('menu')" id="tab-menu"
                class="px-6 py-3 rounded-xl font-bold transition-all bg-white text-gray-600 hover:bg-purple-50">
                üçΩÔ∏è Manage Menu
            </button>
        </div>

        <!-- Orders Section -->
        <div id="section-orders" class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
            <table class="w-full text-left border-collapse">
                <thead class="bg-purple-50 border-b-2 border-purple-200">
                    <tr>
                        <th class="p-5 font-bold text-purple-900 text-sm">‚è∞ Time</th>
                        <th class="p-5 font-bold text-purple-900 text-sm">üë§ Customer</th>
                        <th class="p-5 font-bold text-purple-900 text-sm">üõí Items</th>
                        <th class="p-5 font-bold text-purple-900 text-sm">üí∞ Total</th>
                        <th class="p-5 font-bold text-purple-900 text-sm">üìä Status</th>
                    </tr>
                </thead>
                <tbody id="orders-table" class="divide-y divide-gray-100">
                    <!-- Orders will be injected here -->
                </tbody>
            </table>
        </div>

        <!-- Menu Section -->
        <div id="section-menu" class="hidden space-y-6">
            <!-- Add Item Form -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                <h2 class="text-xl font-bold mb-5 text-gray-900">‚ûï Add New Menu Item</h2>
                <form id="add-item-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Item Name</label>
                            <input type="text" id="new-name"
                                class="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-500 focus:outline-none transition-colors font-medium"
                                placeholder="e.g., Mysore Masala Dosa" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Price (‚Çπ)</label>
                            <input type="number" id="new-price"
                                class="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-500 focus:outline-none transition-colors font-medium"
                                placeholder="e.g., 80" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Category</label>
                            <select id="new-category"
                                class="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-500 focus:outline-none transition-colors font-medium">
                                <option>Breakfast</option>
                                <option>Lunch</option>
                                <option>Dinner</option>
                                <option>Snacks</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Image URL</label>
                            <input type="text" id="new-image"
                                class="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-500 focus:outline-none transition-colors font-medium"
                                placeholder="https://..."
                                value="https://images.unsplash.com/photo-1589301760574-0a6f91d25815?auto=format&fit=crop&w=300&q=80">
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full gradient-purple text-white py-3 px-4 rounded-xl font-bold hover:shadow-lg transition-all transform hover:scale-105">
                        ‚ú® Add Item to Menu
                    </button>
                </form>
            </div>

            <!-- Menu List -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-purple-50 border-b-2 border-purple-200">
                        <tr>
                            <th class="p-5 font-bold text-purple-900 text-sm">üñºÔ∏è Image</th>
                            <th class="p-5 font-bold text-purple-900 text-sm">üìù Name</th>
                            <th class="p-5 font-bold text-purple-900 text-sm">üè∑Ô∏è Category</th>
                            <th class="p-5 font-bold text-purple-900 text-sm">üíµ Price</th>
                            <th class="p-5 font-bold text-purple-900 text-sm">‚öôÔ∏è Actions</th>
                        </tr>
                    </thead>
                    <tbody id="menu-table" class="divide-y divide-gray-100">
                        <!-- Menu items will be injected here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:3000/api";
        let currentTab = 'orders';

        // --- TABS ---
        function switchTab(tab) {
            currentTab = tab;

            // Update Buttons
            document.getElementById('tab-orders').className = tab === 'orders'
                ? "px-6 py-3 rounded-xl font-bold transition-all bg-purple-600 text-white shadow-lg"
                : "px-6 py-3 rounded-xl font-bold transition-all bg-white text-gray-600 hover:bg-purple-50";
            document.getElementById('tab-menu').className = tab === 'menu'
                ? "px-6 py-3 rounded-xl font-bold transition-all bg-purple-600 text-white shadow-lg"
                : "px-6 py-3 rounded-xl font-bold transition-all bg-white text-gray-600 hover:bg-purple-50";

            // Show/Hide Sections
            document.getElementById('section-orders').classList.toggle('hidden', tab !== 'orders');
            document.getElementById('section-menu').classList.toggle('hidden', tab !== 'menu');

            fetchData();
        }

        // --- DATA FETCHING ---
        async function fetchData() {
            const btn = document.querySelector('button[onclick="fetchData()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = "‚è≥ Loading...";

            try {
                if (currentTab === 'orders') {
                    await fetchOrders();
                } else {
                    await fetchMenu();
                }
                document.getElementById('last-updated').innerText = "Last updated: " + new Date().toLocaleTimeString();
            } catch (error) {
                console.error("Error fetching data:", error);
                alert("‚ö†Ô∏è Error fetching data. Is the server running?");
            } finally {
                btn.innerHTML = originalText;
            }
        }

        async function fetchOrders() {
            const response = await fetch(`${API_URL}/orders`);
            const orders = await response.json();
            renderOrders(orders);
        }

        async function fetchMenu() {
            const response = await fetch(`${API_URL}/menu`);
            const menu = await response.json();
            renderMenu(menu);
        }

        // --- RENDERING ---
        function renderOrders(orders) {
            const tbody = document.getElementById('orders-table');
            if (orders.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-12 text-center">
                    <div class="text-6xl mb-3">üì≠</div>
                    <p class="text-gray-500 font-semibold">No orders yet</p>
                </td></tr>`;
                return;
            }
            tbody.innerHTML = orders.map(order => {
                const date = new Date(order.timestamp).toLocaleString();
                const itemsHtml = order.items.map(i => `<div class="text-sm text-gray-600"><span class="font-bold text-purple-600">${i.quantity}√ó</span> ${i.name}</div>`).join('');
                return `
                <tr class="card-hover">
                    <td class="p-5 text-sm text-gray-600 whitespace-nowrap font-medium">${date}</td>
                    <td class="p-5">
                        <div class="font-bold text-gray-900">${order.name}</div>
                        <div class="text-xs text-gray-500 mt-1">${order.address}</div>
                    </td>
                    <td class="p-5">${itemsHtml}</td>
                    <td class="p-5 font-bold text-lg text-purple-600">‚Çπ${order.totalPrice}</td>
                    <td class="p-5">
                        <span class="bg-yellow-100 text-yellow-800 text-xs font-bold px-3 py-1.5 rounded-full border border-yellow-300">
                            ‚è≥ Pending
                        </span>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderMenu(menu) {
            const tbody = document.getElementById('menu-table');
            tbody.innerHTML = menu.map(item => `
                <tr class="card-hover">
                    <td class="p-5">
                        <img src="${item.image}" class="w-16 h-16 rounded-xl object-cover bg-gray-100 border-2 border-gray-200 shadow-sm">
                    </td>
                    <td class="p-5 font-bold text-gray-900">${item.name}</td>
                    <td class="p-5">
                        <span class="text-sm text-gray-600 bg-purple-50 px-3 py-1 rounded-full font-medium">${item.category}</span>
                    </td>
                    <td class="p-5 font-bold text-lg text-purple-600">‚Çπ${item.price}</td>
                    <td class="p-5">
                        <button onclick="deleteItem(${item.id})" class="text-red-500 hover:text-red-700 font-bold text-sm bg-red-50 px-4 py-2 rounded-lg hover:bg-red-100 transition-colors">
                            üóëÔ∏è Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // --- ACTIONS ---
        document.getElementById('add-item-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const newItem = {
                name: document.getElementById('new-name').value,
                price: parseInt(document.getElementById('new-price').value),
                category: document.getElementById('new-category').value,
                image: document.getElementById('new-image').value
            };

            try {
                await fetch(`${API_URL}/menu`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newItem)
                });

                document.getElementById('add-item-form').reset();
                fetchData();
                alert("‚úÖ Item added successfully!");
            } catch (error) {
                alert("‚ö†Ô∏è Error adding item");
            }
        });

        async function deleteItem(id) {
            if (confirm("üóëÔ∏è Are you sure you want to delete this item?")) {
                try {
                    await fetch(`${API_URL}/menu/${id}`, { method: 'DELETE' });
                    fetchData();
                    alert("‚úÖ Item deleted successfully!");
                } catch (error) {
                    alert("‚ö†Ô∏è Error deleting item");
                }
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(fetchData, 30000);

        // Initial load
        fetchData();
    </script>
</body>

</html>